<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
    <style type="text/css">
      #map {
        height: 300px;
      }
    </style>
  </head>
  <body>
    <h1>Hello, world!</h1>
    <div id="hover"></div>

    <div id="map"></div>


    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
    <script type="text/javascript">
      $(function(){
        var map = L.map('map').setView([42.42, -83.02 ], 13);
         baseLayer = L.tileLayer('http://a.tiles.mapbox.com/v3/matth.map-zmpggdzn/{z}/{x}/{y}.png');
         map.addLayer(baseLayer);
        var dots = L.layerGroup().addTo(map);
        var style = {
          stroke: false,
          fillColor: 'blue',
          fillOpacity: 1,
          radius: 5
        };

         var success = function(data) {
          console.log(data);
          var ll = [data.lat, data.lng];
          var marker = L.circleMarker(ll, style);
          dots.addLayer(marker);
          map.panTo(ll);
         };


        var fetch = function() {
          var jqxhr = $.ajax('/position', {
            dataType: 'json'
          });

          jqxhr.done(success);

          jqxhr.fail(function(error) {
            console.log(error);
          });
        };

         // Check for the location
        window.setInterval(fetch, 1000);

      });
    </script>
  </body>
</html>
